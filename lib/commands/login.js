const prompt=require('../util/prompt'),signInUser=()=>{let a,b;return Promise.resolve(pgb.opts.commands[1]||pgb.opts.variables.auth_token||prompt('Adobe ID or Authentication Token: ')).then((c)=>(a=c,c.match('^[^@]+@[^@]+.[^@]+$')?prompt('Password: ',{mask:!0}).then((c)=>(b=c,pgb.api.addAuth(a,b),pgb.api.getToken(a,b))):(pgb.api.addAuth(c),{token:c}))).then((a)=>(pgb.debug(`saving auth_token to ${pgb.session.path}`),pgb.session.save({authtoken:a.token}),pgb.api.me())).catch((a)=>{if(a&&401===a.statusCode){let a=b?'Adobe ID or password incorrect':'invalid authentication token';return Promise.reject(new Error(a))}return Promise.reject(a)})};module.exports=()=>pgb.api.me().catch(signInUser).then((a)=>pgb.print({pretty:'signed in as '+pgb.colours.bold(a.email),json:a,bare:a.id}));